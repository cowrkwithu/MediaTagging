# 시스템 설계서

**프로젝트명:** editVideoTagging
**버전:** v20260126151726
**작성일:** 2026-01-26

---

## 1. 개요

본 문서는 동영상 태깅 및 검색 웹 애플리케이션의 시스템 설계를 정의한다.

---

## 2. 시스템 아키텍처

### 2.1 전체 아키텍처

```
┌─────────────────────────────────────────────────────────────────┐
│                         Client (Browser)                         │
│                      React / Next.js Frontend                    │
└─────────────────────────────┬───────────────────────────────────┘
                              │ HTTP/HTTPS
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        Backend Server                            │
│                     Node.js / Express or                         │
│                     Python / FastAPI                             │
├─────────────────────────────────────────────────────────────────┤
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐   │
│  │ Video Upload │  │ Search API   │  │ External API Handler │   │
│  │    Module    │  │   Module     │  │  (Google Nanobana)   │   │
│  └──────────────┘  └──────────────┘  └──────────────────────┘   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────────────┐   │
│  │ Scene Split  │  │  Tagging     │  │   Export Module      │   │
│  │    Module    │  │   Module     │  │                      │   │
│  └──────────────┘  └──────────────┘  └──────────────────────┘   │
└─────────────────────────────┬───────────────────────────────────┘
                              │
          ┌───────────────────┼───────────────────┐
          ▼                   ▼                   ▼
┌──────────────────┐ ┌──────────────────┐ ┌──────────────────┐
│    Database      │ │   File Storage   │ │   AI Service     │
│   PostgreSQL     │ │  Local / S3      │ │  Ollama (Local)  │
└──────────────────┘ └──────────────────┘ └──────────────────┘
```

### 2.2 계층 구조

| 계층 | 역할 | 기술 |
|------|------|------|
| Presentation | 사용자 인터페이스 | React / Next.js |
| Application | 비즈니스 로직 | Node.js / Python |
| Data | 데이터 저장 및 관리 | PostgreSQL, File Storage |
| External | 외부 서비스 연동 | Google Nanobana API, Ollama |

---

## 3. 기술 스택

### 3.1 Frontend

| 구분 | 기술 | 비고 |
|------|------|------|
| Framework | Next.js 14+ | React 기반 풀스택 프레임워크 |
| Language | TypeScript | 타입 안정성 확보 |
| Styling | Tailwind CSS | 유틸리티 기반 CSS |
| State Management | Zustand / React Query | 서버 상태 관리 |
| Video Player | Video.js / React Player | 동영상 재생 |

### 3.2 Backend

| 구분 | 기술 | 비고 |
|------|------|------|
| Framework | FastAPI (Python) | 비동기 처리, AI 라이브러리 호환 |
| Language | Python 3.11+ | AI/ML 생태계 활용 |
| Video Processing | FFmpeg | 영상 분할, 인코딩 |
| Scene Detection | PySceneDetect | 장면 전환 감지 |

### 3.3 Database

| 구분 | 기술 | 비고 |
|------|------|------|
| RDBMS | PostgreSQL | 메타데이터 저장 |
| Full-text Search | PostgreSQL FTS | 키워드 검색 |

### 3.4 AI/ML

| 구분 | 기술 | 비고 |
|------|------|------|
| LLM Runtime | Ollama | 로컬 LLM 실행 |
| Models | Gemma3:27b, Qwen3:14b | 요약 및 태그 생성 |
| Vision Model | (추후 선정) | 영상 프레임 분석 |

### 3.5 Infrastructure

| 구분 | 기술 | 비고 |
|------|------|------|
| Container | Docker | 개발/배포 환경 일관성 |
| File Storage | Local / AWS S3 | 동영상 파일 저장 |

---

## 4. 데이터베이스 설계

### 4.1 ERD (Entity Relationship Diagram)

```
┌─────────────────────┐       ┌─────────────────────┐
│       videos        │       │       scenes        │
├─────────────────────┤       ├─────────────────────┤
│ id (PK)             │───┐   │ id (PK)             │
│ filename            │   │   │ video_id (FK)       │──┐
│ title               │   └──▶│ start_time          │  │
│ summary             │       │ end_time            │  │
│ user_notes          │       │ thumbnail_path      │  │
│ file_path           │       │ clip_path           │  │
│ duration            │       │ created_at          │  │
│ file_size           │       └─────────────────────┘  │
│ status              │                                │
│ created_at          │       ┌─────────────────────┐  │
│ updated_at          │       │     scene_tags      │  │
└─────────────────────┘       ├─────────────────────┤  │
          │                   │ id (PK)             │  │
          │                   │ scene_id (FK)       │◀─┘
          ▼                   │ tag_id (FK)         │──┐
┌─────────────────────┐       │ confidence          │  │
│    video_tags       │       │ created_at          │  │
├─────────────────────┤       └─────────────────────┘  │
│ id (PK)             │                                │
│ video_id (FK)       │       ┌─────────────────────┐  │
│ tag_id (FK)         │       │        tags         │  │
│ confidence          │       ├─────────────────────┤  │
│ created_at          │       │ id (PK)             │◀─┘
└─────────────────────┘       │ name (UNIQUE)       │
                              │ created_at          │
                              └─────────────────────┘
```

### 4.2 테이블 정의

#### videos (동영상)

| 컬럼 | 타입 | 제약조건 | 설명 |
|------|------|----------|------|
| id | UUID | PK | 고유 식별자 |
| filename | VARCHAR(255) | NOT NULL | 원본 파일명 |
| title | VARCHAR(500) | | 사용자 입력 제목 |
| summary | TEXT | | AI 생성 요약 |
| user_notes | TEXT | | 사용자 입력 기록 |
| file_path | VARCHAR(1000) | NOT NULL | 저장 경로 |
| duration | INTEGER | | 영상 길이 (초) |
| file_size | BIGINT | | 파일 크기 (bytes) |
| status | VARCHAR(50) | NOT NULL | 처리 상태 |
| created_at | TIMESTAMP | NOT NULL | 생성일시 |
| updated_at | TIMESTAMP | NOT NULL | 수정일시 |

**status 값:**
- `uploaded`: 업로드 완료
- `processing`: 처리 중
- `tagged`: 태깅 완료
- `error`: 오류 발생

#### scenes (장면)

| 컬럼 | 타입 | 제약조건 | 설명 |
|------|------|----------|------|
| id | UUID | PK | 고유 식별자 |
| video_id | UUID | FK | 영상 ID |
| start_time | FLOAT | NOT NULL | 시작 시간 (초) |
| end_time | FLOAT | NOT NULL | 종료 시간 (초) |
| thumbnail_path | VARCHAR(1000) | | 썸네일 경로 |
| clip_path | VARCHAR(1000) | | 분할 영상 경로 |
| created_at | TIMESTAMP | NOT NULL | 생성일시 |

#### tags (태그)

| 컬럼 | 타입 | 제약조건 | 설명 |
|------|------|----------|------|
| id | UUID | PK | 고유 식별자 |
| name | VARCHAR(100) | UNIQUE, NOT NULL | 태그명 |
| created_at | TIMESTAMP | NOT NULL | 생성일시 |

#### video_tags (영상-태그 연결)

| 컬럼 | 타입 | 제약조건 | 설명 |
|------|------|----------|------|
| id | UUID | PK | 고유 식별자 |
| video_id | UUID | FK | 영상 ID |
| tag_id | UUID | FK | 태그 ID |
| confidence | FLOAT | | 신뢰도 (0.0 ~ 1.0) |
| created_at | TIMESTAMP | NOT NULL | 생성일시 |

#### scene_tags (장면-태그 연결)

| 컬럼 | 타입 | 제약조건 | 설명 |
|------|------|----------|------|
| id | UUID | PK | 고유 식별자 |
| scene_id | UUID | FK | 장면 ID |
| tag_id | UUID | FK | 태그 ID |
| confidence | FLOAT | | 신뢰도 (0.0 ~ 1.0) |
| created_at | TIMESTAMP | NOT NULL | 생성일시 |

---

## 5. API 설계

### 5.1 REST API 엔드포인트

#### 동영상 관리

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | /api/videos/upload | 동영상 업로드 |
| GET | /api/videos | 동영상 목록 조회 |
| GET | /api/videos/{id} | 동영상 상세 조회 |
| PUT | /api/videos/{id} | 동영상 메타데이터 수정 |
| DELETE | /api/videos/{id} | 동영상 삭제 |

#### 태깅 작업

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | /api/videos/{id}/tagging/start | 태깅 작업 시작 |
| GET | /api/videos/{id}/tagging/status | 태깅 작업 상태 조회 |
| GET | /api/videos/{id}/scenes | 장면 목록 조회 |
| GET | /api/scenes/{id} | 장면 상세 조회 |

#### 장면 내보내기

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | /api/scenes/export | 선택 장면 영상 저장 |
| GET | /api/scenes/{id}/download | 장면 영상 다운로드 |

#### 검색

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | /api/search | 키워드 검색 |
| GET | /api/tags | 태그 목록 조회 |

#### 외부 API 연동

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | /api/external/nanobana/request | Nanobana API 요청 |
| GET | /api/external/nanobana/status/{id} | 요청 상태 조회 |

### 5.2 검색 쿼리 문법

```json
{
  "query": {
    "and": ["태그1", "태그2"],
    "or": ["태그3", "태그4"],
    "not": ["태그5"]
  },
  "target": ["videos", "scenes"],
  "page": 1,
  "limit": 20
}
```

**검색 예시:**

| 검색 의도 | 쿼리 |
|----------|------|
| "고양이"와 "귀여운" 모두 포함 | `{"and": ["고양이", "귀여운"]}` |
| "고양이" 또는 "강아지" 포함 | `{"or": ["고양이", "강아지"]}` |
| "고양이" 포함, "싸움" 제외 | `{"and": ["고양이"], "not": ["싸움"]}` |

---

## 6. 모듈 설계

### 6.1 Backend 모듈 구조

```
backend/
├── app/
│   ├── main.py                 # FastAPI 앱 진입점
│   ├── config.py               # 설정 관리
│   ├── api/
│   │   ├── routes/
│   │   │   ├── videos.py       # 동영상 API
│   │   │   ├── scenes.py       # 장면 API
│   │   │   ├── search.py       # 검색 API
│   │   │   └── external.py     # 외부 API
│   │   └── dependencies.py     # 의존성 주입
│   ├── services/
│   │   ├── video_service.py    # 동영상 비즈니스 로직
│   │   ├── scene_service.py    # 장면 처리 로직
│   │   ├── tagging_service.py  # 태깅 로직
│   │   ├── search_service.py   # 검색 로직
│   │   └── ai_service.py       # AI 연동 로직
│   ├── models/
│   │   ├── video.py            # 동영상 모델
│   │   ├── scene.py            # 장면 모델
│   │   └── tag.py              # 태그 모델
│   ├── schemas/
│   │   ├── video.py            # 동영상 스키마
│   │   ├── scene.py            # 장면 스키마
│   │   └── search.py           # 검색 스키마
│   └── utils/
│       ├── video_processor.py  # FFmpeg 래퍼
│       ├── scene_detector.py   # 장면 감지
│       └── ollama_client.py    # Ollama 클라이언트
├── tests/
└── requirements.txt
```

### 6.2 Frontend 모듈 구조

```
frontend/
├── src/
│   ├── app/                    # Next.js App Router
│   │   ├── page.tsx            # 메인 페이지
│   │   ├── upload/             # 업로드 페이지
│   │   ├── videos/             # 동영상 관리 페이지
│   │   │   └── [id]/           # 동영상 상세
│   │   └── search/             # 검색 페이지
│   ├── components/
│   │   ├── VideoUploader.tsx   # 업로드 컴포넌트
│   │   ├── VideoPlayer.tsx     # 비디오 플레이어
│   │   ├── SceneList.tsx       # 장면 목록
│   │   ├── TagEditor.tsx       # 태그 편집기
│   │   └── SearchForm.tsx      # 검색 폼
│   ├── hooks/
│   │   ├── useVideos.ts        # 동영상 훅
│   │   └── useSearch.ts        # 검색 훅
│   ├── lib/
│   │   └── api.ts              # API 클라이언트
│   └── types/
│       └── index.ts            # 타입 정의
├── public/
└── package.json
```

---

## 7. 처리 흐름

### 7.1 동영상 업로드 및 태깅 흐름

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│  Upload  │────▶│  Store   │────▶│ Generate │────▶│   Save   │
│  Video   │     │  File    │     │ Summary  │     │ Metadata │
└──────────┘     └──────────┘     │ & Tags   │     └──────────┘
                                  └──────────┘
                                       │
                                       ▼ (사용자 요청 시)
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│  Return  │◀────│  Store   │◀────│ Generate │◀────│  Detect  │
│  Result  │     │ Scene    │     │ Scene    │     │  Scenes  │
└──────────┘     │ Tags     │     │ Tags     │     └──────────┘
                 └──────────┘     └──────────┘
```

### 7.2 검색 흐름

```
┌──────────┐     ┌──────────┐     ┌──────────┐     ┌──────────┐
│  Parse   │────▶│  Build   │────▶│ Execute  │────▶│  Return  │
│  Query   │     │   SQL    │     │  Query   │     │ Results  │
└──────────┘     └──────────┘     └──────────┘     └──────────┘
```

---

## 8. 외부 시스템 연동

### 8.1 Ollama (로컬 LLM)

| 항목 | 내용 |
|------|------|
| 용도 | 영상 요약, 태그 생성 |
| 프로토콜 | HTTP REST API |
| 기본 엔드포인트 | http://localhost:11434 |
| 사용 모델 | gemma3:27b, qwen3:14b |

### 8.2 Google Nanobana API

| 항목 | 내용 |
|------|------|
| 용도 | 동영상 제작 요청 |
| 프로토콜 | HTTP REST API |
| 인증 | API Key |
| 연동 방식 | 비동기 요청/콜백 |

---

## 9. 보안 고려사항

| 항목 | 대응 방안 |
|------|----------|
| 파일 업로드 | 파일 타입 검증, 크기 제한 |
| API 인증 | JWT 또는 세션 기반 인증 |
| SQL Injection | ORM 사용, 파라미터 바인딩 |
| XSS | 입력값 이스케이프 |
| CORS | 허용 도메인 제한 |

---

## 10. 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| v20260126151726 | 2026-01-26 | - | 최초 작성 |
